## 概念
### boootloader简介
系统上电后，需要一段程序来进行初始化：关闭看门狗，改变系统时钟，初始化存储控制器，将更多的代码复制到内存中等，就是bootloader。

bootloader非常依赖具体硬件，即使相同的CPU，外设(flash)可能不同，不可能有一个Bootloader支持所有电路和所有电板.

CPU上电后，会从某个地址开始执行，比如MIPS结构CPU会从0XBFC0000取第一条指令，而ARM结构的CPU则会0X0000000开始，嵌入式开发板中，需要把存储器件的ROM或Flash等映射到这个地址，Bootloader就存放在这个地址开始处，一上电就开始执行.

### 软件层次
一个嵌入式系统从软件角度来看分为三个层次:

* 1.引导加载程序：包括固化在固件(firmware)中的boot程序(可选)和BootLoader两大部分。
* 2.Linux内核：特定嵌入式平台的定制内核
* 3.文件系统：包括了系统命令和应用程序

同时装载BootLoader,内核启动参数，内核镜像和跟文件系统映像的固态存储设备典型分配结构图:

<center>
<image src="./image/01-01.jpg">
01-01 系统存储结构空间图
</center>

### BootLoader
**PC机程序加载过程**PC机中`引导加载程序`有`BIOS`(本质是一段固件程序)和`GRUB或LILO`一起组成。BIOS在完成硬件检测和资源分配后，将硬盘中的引导程序读到系统内存中然后将控制权交给引导程序。`引导程序主要任务`是`将内核从硬盘上读到内存中，然后跳转到内核入口点去运行，即启动操作系统`。

**嵌入式系统**通常没有BIOS固件程序，`整个系统的加载启动完成任务由BootLoader来完成。`如：一个基于ARM7TDMI core嵌入式系统，系统上电或复位都从地址0x000000开始执行。而这个地址处安排通常就是系统的BootLoader程序。

简单来说BootLoader就是在操作系统运行之前运行一段小程序。这段小程序可以：

* 初始化硬件设备，将系统的软硬件环境带到一个合适的状态，以便于最终调用操作系统做好的准备.

## 安装
> 系统加电或复位后，所有的CPU通常都从CPU制造商预先安排地址开始执行。

而嵌入式系统则将固态存储设备(如FLASH)，安排在这个地址上，而BootLoader又安排在固态存储的最前端，这样保证系统加电后，CPU首先执行BootLoader程序.

## 移植
1.每种不同的CPU体系结构都有不同的BootLoader.

2.BootLoader还依赖`具体嵌入式板级设备的配置`，如板卡硬件地址分配，外设芯片的类型等。

所以CPU或硬件资源不一致还是需要移植的。

## BootLoader启动流程

BootLoader启动过程可分为`单阶段`和`多阶段`。BootLoader大多数采用`两阶段`,启动过程可分为两阶段stage1和state2：

* stage1完成初始化硬件，为stage2准备内存空间，并将stage2复制到内存中，设置好堆栈。
	* 初始化硬件
	* 为bootloader的stage2准备RAM空间
	* 拷贝BootLoader的stage2到RAM空间中
	* 设置好堆栈
	* 跳转到stage2的C入口点
* 跳转到stage2：
	* 初始化本阶段要使用到的硬件设备
	* 将内核映像和根文件系统从flash上读到RAM中。
	* 调用内核
	
<center>
<image src="./image/01-02.jpg">
01-02 Flash和RAM镜像分布
</center>

# 2.UBOOT
UBOOT 目标是启动内核：从 flash 上读出内核到 SDRAM 中去。启动内核。
硬件相关的初始化：关‘看门狗’、‘初始化时钟’、‘初始化 SDRAM’、‘从 FLASH 读出内核’

## 2.1‘启动内核’。

增强功能：烧写 FLASH（从网卡或从 USB）。串口（通过串口写命令）。

1，读 flash:
2，初始化 SDRAM：
初始化时钟，单板上电后是以 12M 运行的（晶振为 12M）。
初始化串口。为开发方便要写 flash 功能（通过网络或 USB 烧镜像到单板上）.
3，启动内核：
