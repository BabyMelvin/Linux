GNU 汇编语言定义函数的语法:

```asm
.type 标签(也就是函数名), @function
ret 返回到调用处
```

# 嵌入汇编

C程序中嵌入汇编代码，具体输入和输出参数的嵌入汇编语句的基本格式为：

```
asm("汇编语句"
	:输出寄存器
	:输入寄存器
	:会被修改的寄存器);
```

* 除第1行外，后面带冒号都可以省略
* asm:内联汇编关键字。
* 输出寄存器，汇编执行完之后，哪些寄存器用于存放输出数据，寄存器分别对应C语言表达式值或一个内存地址
* 输入寄存器：开始执行汇编代码时，指定的一些寄存器中存放的输入值，分别对应着C变量或常数值。
* 会被修改的寄存器：你对其列出来的寄存器值进行了改动,gcc编译器不能再依赖于原先对这些寄存器加载的值。如必要话，gcc需要重新加载这些寄存器.`kernel/traps.c`

```
#define get_seg_byte(seg,addr) \
({ \
register char __res; \  //定义一个寄存器变量__res
__asm__("push %%fs; \  //先保存fs寄存器原值
		mov %%ax,%%fs;\ //然后用seg设置fs
		movb %%fs:%2,%%al; \ //取set:addr处一个字节内容到al寄存器中
		pop %%fs"   \      //恢复fs寄存器原内容
		:"=a" (__res) \    //输出寄存器列表
		:"0" (seg),"m" (*(addr))); \ //输出寄存器列表
__rest;})
```