# ARM ATPCS
ATPCS定义ARM和C语言之间的调用规则.包括子程序调用过程中寄存器使用规则，数据栈的使用规则，参数的传递规则。

## 1.基本规则
基本ATPCS规定了在子程序调用时的一些基本规则，包括3个方面的内容：

* 1.各寄存器的使用规则及其相应的名称
* 2.数据栈的使用规则
* 3.参数传递的规则

### 1.1寄存器使用规则

* 1.子程序间通过寄存器R0~R3来传递参数，可以记作为A0~A3.被调用子程序无需恢复R0~rR3的内容
* 2.在子程序中，使用寄存器R4~R11作为局部变量。可记作为V1~V8.进入之前必须记住V1~V8的值，返回后进行恢复.
* 3.寄存器R12用作为子程序间scratch寄存器(用于保存SP，在函数返回时使用该寄存器出栈)，记作ip。
* 4.寄存器R13用作数据栈指针，记做sp。进入和出去的值必须相等
* 5.寄存器R14作为链接寄存器，记作lr
* 6.寄存器R15记作为PC,程序计数器.

### 1.2数据栈使用

栈指针通常指向不同的位置。当栈指针指向栈顶元素，成为FULL栈；当栈指针指向与栈顶元素相邻的一个可用数据单元，称为EMPTY栈。

由4种数据：

* FD：full descending
* ED:empty descending
* FA full ascending
* EA:empty ascending

ATPCS规定数据栈为FD类型，并且数据栈的操作时8字节对齐的。

### 1.3 参数传递规则

#### 1.3.1 参数个数可变的子程序参数传递规则
参数个数可变的子程序，当参数不超过4个时，可以使用寄存器R0~R3来传递参数；当参数超过4个时，可以使用数据栈来传递参数

# ARM汇编语言语句格式

`{symbol}{instruction|directive|pseudo-instruction}{;comment}`

* symbol:符号
* instruction:指令
* directive:伪操作
* pseudo-instrkeuction:伪指令
* comment 语句注释

数字常量一般3种表达方式：

* 1.十进制数，如79,4等
* 2.十六进制数：`0x`和`&`开头，如0x345
* 3.n进制开头，用n_xxx表示，如2_01100101,8_5642

标号：表示程序种的指令或数据地址的符号，代表地址
局部符号：主要用于局部范围代码

GNU环境下，ARM汇编语言源程序：

```arm
.equ x,45   /*定义变量x,并赋值为45*/
.equ y,64
.equ stack_top,0x1000

.text
_start:                  /*程序代码开始标志*/
	MOV sp,#stack_top
	MOV r0,#x
	MOV r1,#y
	ADD r2,r1,r0
	STR r2,[sp]

stop:
	B stop
.end
```

