# 嵌入式概述
## 系统运行初始化
* 对于有操作系统支持的应用，系统启动时候将会初始化系统工作环境。操作系统在加载应用后，将控制权转交给应用程序的`main()`函数.然后C运行时库的`_main()`初始化应用程序.
* 对于嵌入式应用系统来说，由于没有操作系统的支持，存放在ROM的代码必须进行所有的初始化工作。

系统运行环境的初始化工作主要包含以下内容：

1. 设置初始入口点。初始化入口点是映像文件运行时的入口点，每个映像文件只有一个唯一的初始化入口点，保存在ELF头文件中。如果映像文件是被操作系统加载的，操作系统正是通过跳转到该入口点处执行来加载该映像文件的。初始化入口点必须满足下面条件：
	* 初始化入口点必须位于映像文件的可执行区域
	* 包含初始化入口点的可执行域不能被覆盖，加载时地址和运行时地址必须是相同的(这种域称为固定域Root Region)
2. 设置中断向量。如果系统运行时，地址0x00处为ROM，则相同的异常中断向量表时固定的，程序在运行过程中不能修改异常中断向量表。如果系统运行时，地址0x00处为RAM，则系统初始化时必须重建异常中断向量表。
3. 初始化存储系统
4. 初始化数据堆栈指针
5. 初始化关键的I/O设备。指那些必须在使能IRQ和FIQ之前进行初始化的I/O设备
6. 设置中断时需要的RAM变量
7. 使能异常中断。通过清除CPSR寄存器的中断禁止位实现
8. 切换处理器模式。直到目前为止，系统还处于特权模式。如果下面运行应用程序，则需要切换到用户模式
9. 切换程序状态，所有RAM内核都是从ARM状态开始执行的

# ARM中的存储映射
ARM映像文件其实就是可执行文件，包括bin或hex两种格式，可知直接烧录到ROM中执行。

ARM映像文件时ELF格式。(Executable and Linking Format)二进制格式，有3种类型：

* 可执行文件
* 可重定位文件
* 共享object文件(又叫共享库)

ELF文件具体内容根据属性、用途不同，构成不同的Section。Section包含目标文件真正有用信息，如代码、数据、调试表、符号表和重定位数据等。

嵌入式而言，程序映像都是在存储Flash存储器等一些非易失性器件种，而运行时，程序种的RW段必须重新装载到可读写的RAM中。涉及到**加载时域**和**运行时域**。