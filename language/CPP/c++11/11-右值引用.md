# 右值引用
右值引用只不过是一种新的 C++ 语法，真正理解起来有难度的是基于右值引用引申出的 2 种 C++ 编程技巧，分别为移动语义和完美转发。

# 1.C++左值和右值
右值引用可以从字面意思上理解，指的是以引用传递（而非值传递）的方式使用 C++ 右值。

通常情况下，判断某个表达式是左值还是右值，最常用的有以下 2 种方法

* 1) 可位于赋值号（=）左侧的表达式就是左值；反之，只能位于赋值号右侧的表达式就是右值。举个例子：

```cpp
int a = 5;
5 = a; // 错误，5不能作为左值
```
其中，变量 a 就是一个左值，而字面量 5 就是一个右值。值得一提的是，C++ 中的左值也可以当做右值使用，例如：

```cpp
int b = 10; // b是一个左值
a = b; // a、b都是左值，只不过将b可以当做右值使用
```

* 2) 有名称的、可以获取到存储地址的表达式即为左值；反之则是右值。

以上面定义的变量 a、b 为例，a 和 b 是变量名，且通过 &a 和 &b 可以获得他们的存储地址，因此 a 和 b 都是左值；反之，字面量 5、10，它们既没有名称，也无法获取其存储地址（字面量通常存储在寄存器中，或者和代码存储在一起），因此 5、10 都是右值。 

# 2.C++ 右值引用
前面提到，其实 C++98/03 标准中就有引用，使用 "&" 表示。但此种引用方式有一个缺陷，即正常情况下只能操作 C++ 中的左值，无法对右值添加引用。举个例子：

```cpp
int num = 10;
int &b = num; // 正确
int &c = 10; // 错误
```
如上所示，编译器允许我们为 num 左值建立一个引用，但不可以为 10 这个右值建立引用。因此，`C++98/03` 标准中的引用又称为左值引用。

注意，虽然 C++98/03 标准不支持为右值建立非常量左值引用，但**允许使用常量左值引用操作右值**。也就是说，常量左值引用既可以操作左值，也可以操作右值，例如：

```cpp
int num = 10;
const int &b = num;
cont int &c = 10;
```

我们知道，右值往往是没有名称的，因此要使用它只能借助引用的方式。这就产生一个问题，实际开发中我们可能需要对右值进行修改（实现移动语义时就需要），显然左值引用的方式是行不通的。

为此，C++11 标准新引入了另一种引用方式，称为右值引用，用 "&&" 表示。

```cpp
int num = 10;
// int && a = num; //右值引用不能初始化为左值
int &&a = 10;
```
和常量左值引用不同的是，右值引用还可以对右值进行修改。例如：

```cpp
int && a = 10;
a = 100;
cout << a << endl;
// 结果输出为100
```
另外值得一提的是，C++ 语法上是支持定义常量右值引用的，例如：

```cpp
const int &&a = 10; // 编译器不会报错
```

但这种定义出来的右值引用并无实际用处。一方面，右值引用主要用于移动语义和完美转发，其中前者需要有修改右值的权限；其次，常量右值引用的作用就是引用一个不可修改的右值，这项工作完全可以交给常量左值引用完成。

学到这里，一些读者可能无法记清楚左值引用和右值引用各自可以引用左值还是右值，这里给大家一张表格，方便大家记忆：


