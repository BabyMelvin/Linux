# 柔性数组
1. 什么是柔性数组？

柔性数组既数组大小待定的数组，C语言中结构体的最后一个元素可以是**大小未知的数组**，也就是所谓的**0长度**，所以我们可以用结构体来创建柔性数组。

2. 柔性数组有什么用途 ？

它的主要用途是为了满足需要**变长度的结构体**，为了解决使用数组时**内存的冗余**和**数组的越界问题**。

3. 怎么用？

用法 ：在一个结构体的最后 ，申明一个长度为空的数组，就可以使得这个结构体是可变长的。对于编译器来说，此时长度为0的数组并不占用空间，因为数组名.本身不占空间，它只是一个偏移量， 数组名这个符号本身代 表了一个不可修改的地址常量 （注意：数组名永远都不会是指针！ ），但对于这个**数组的大小**，我们可以进行动态分配,对于编译器而言，数组名仅仅是一个符号，它不会占用任何空间，它在结构体中，只是代表了一个偏移量，代表一个不可修改的**地址常量**！

对于柔性数组的这个特点，很容易构造出变成结构体，如缓冲区，数据包等等：

```c
typdef struct _SoftArray {
	int len;
	int array[];
} SoftArray;
```
这样的变长数组常用于网络通信中构造不定长数据包，不会浪费空间浪费网络流量，比如我要发送1024字节的数据，如果用定长包，假设定长包的长度为2048，就会浪费1024个字节的空间，也会造成不必要的流量浪费。

```c
#include<stdio.h>
#include<stdlib.h>
#include<malloc.h>

typedef struct _SoftArray {
    int len;
    int array[]; //或者int array[0];效果一样，避免编译问题
} SoftArray;

int main() 
{
    int len = 10;
    SoftArray *p = (SoftArray *)malloc(sizeof(SoftArray) + sizeof(int) * len);
    printf("struct size :%d\n", sizeof(SoftArray));
	//运行结果struct size :4
    return 0;
}
```

# 注意

在定义这个结构体的时候，模子的大小就C89不支持这种东西，C99把它作为一种特例加入了标准。

但是，C99所支持的是incomplete type，而不是zero array，形同`int item[0];`这种形式是非法的，C99支持的形式是形同`int item[];`只不过有些编译器把`int item[0];`作为非标准扩展来支持，而且在C99发布之前已经有了这种非标准扩展了，C99发布之后，有些编译器把两者合而为一了。当然，上面既然用 malloc函数分配了内存，肯定就需要用free函数来释放内存：free(p);