# 颜色空间

`颜色空间(color space)`是颜色集合的数学表示.三个最常用的颜色模型RGB(用于计算机图形学)；YIQ、YUV、或YCbCr(用于视频系统中)；CMYK（用于色彩打印）。但是，这些颜色空间都与`色度`、`饱和度`和`亮度`这些直概念**没有直接的关系**。这使得人们暂时去寻求其他的模型，如HSI和HSV，来简化变成、处理和终端用户操作。

## 1.RGB颜色空间
RGB颜色空间广泛用于计算机图形学和显示器。红绿蓝是三种基本的加性颜色(**各个颜色成分相加来形成所需的颜色**)，可以用三位笛卡尔坐标系来表示颜色RGB颜色空间。

<image src="image/3-1.png"/>
立方体中对角线所代表颜色的每个基本颜色分量相等，对角线不同的点具有不同的灰度值。下表包含RGB值具有100%的幅度、100%饱和彩条(color bar)和公共的视频测试信号。

<image src="image/3-1-1.png"/>
RGB颜色空间是计算机图形学最通常的选择，因为彩色显示器采用红、绿和蓝三色来生成目标颜色。因此，选择RGB颜色空间简化了系统的架构与设计。RGB可以使用大量已有的模块。

但是，处理现实图像时，使用RGB颜色有些局限。RGB生成任何一种颜色都需要相同的带宽，使得每个RGB颜色分量的帧缓冲需要童颜的像素深度和显示分辨率。如改变亮度或颜色，必须重新计算亮度和颜色，如果能够直接修改处理会更快。所以许多视频采用亮度(luma)和两个色差信号。最常用采用YUV、YIQ和YCbCr颜色空间。

## 2.YUV颜色空间

YUV颜色空间是下面三大复合颜色视频标准采用的颜色空间:PAL(逐行倒相彩色电视制式)、NTSC(美国国家电视委员会制式)和SECAM（按序传送彩色与存储制式）。
* 黑白系统仅使用亮度(Y)信息；颜色信息（U和V）以一种特定的方式加入，使得黑白电视接收机同样可以显示标准的黑白图像。
* 彩色电视机额外的彩色信息进行解码从而显示彩色画面。

gamma校验的RGB(表示为R'G'B')与YUV颜色空间之间的转化公式为:
```
Y=0.299R'+0.587G'+0.114B'
U=-0.147R'-0.289G'+0.436B'
 =0.492(B'-Y)
V=0.615R'-0.515G'-0.100B'
 =0.877(B'-Y)

R'=Y+1.140V
G'=Y-0.395U-0.581V
B'=Y+2.032U
```

对于取值范围为0~255的数字`R'G'B`值，Y的取值范围为`0~255`,U的取值范围`0~±122`，V的取值范围为`0~±157`.通常可以对这些公式转换进行裁剪以简化在实际的NTSC或PAL数字编码和解码器中实现。
**注意**对于数字数据，8位YUV和R'G'B'数据应该在0和255处饱和，以避免向下溢出和向上溢出导致的**反转问题**。

如果使用了(B'-Y')和(R'-Y')整个取值范围，那么复合NTSC和PAL的量化等级将超出黑白电视发送器和接收器所能承受的范围。**实验表明**：调制的次波在白色以上和黑色以下的偏移达到亮度信号(Y)偏移的20%是准许的。那么需要选择缩放因子是的最大的量化等级对应于75%的幅度，100%的饱和黄色和青色彩条，即这个颜色为最亮的白色(100IRE).

## 3.YCbCr颜色空间

随着数字分量视频标准的发展，YCbCr颜色空间作为ITU-RBT.601的一部发展起来了。YCbCr颜色空间是YUV颜色空间的缩放和偏移版本。

* Y定义为具有8位，标准颜色表示范围`16~235`
* Cb和Cr标称颜色表示范围定为16~240.

我们将几种YCbCr采样格式进行描述,如`4:4:4`,`4:2:2`,`4：1：1`和`4:2:0`.

### 3.1RGB与YCbCr颜色空间之间的转换公式:SDTV

#### 3.1.1 RGB与YCbCr颜色空间之间的转换:模拟公式。
许多规范的假定源信号为模拟R'G'B'，并具有0-1的归一化颜色范围。这样，首先要转换为模拟的YCbCr颜色空间

```
Y=0.299R'+0.587G'+0.144B'
Pb=-0.169R'-0.331G'+0.500B'
Pr=0.500R'-0.419G'-0.081B'
```
为了生成8位正确的YCbCr颜色，需要将模拟YCbCr颜色量化为8位的颜色值：
```
Y=round[219Y+16]
Cb=round[224Pb+128]
Cr=round[224Pr+128]
```

#### 3.1.2 RGB到YCbCr颜色空间的转换：数字公式
#### 3.1.3 YCbCr到RGB颜色空间的转换：模式公式
#### 3.1.4 YCbCr到RGB颜色空间的转换：数字公式
#### 3.1.5 YCbCr到RGB颜色空间转换的一般注意事项
#### 3.1.6 关于计算机系统的注意事项
### 3.2 RGB与YCbCr颜色空间之间的转换公式：HDTV
### 3.3.1 `4:4:4 YCbCr`格式
下图表示4:4：4格式YCbCr采样点的定位。每个采样点有Y，Cb和Cr值，每个颜色值的各颜色分量具有典型的8位(消费类应用)或10位(专业视频应用)。因此每个采样点需要24位。（专业视频应用则为30位）

<image src="image/3-2.png"/>

**注意**：隔行扫描，是两个不同的场。

### 3.3.2 `4:2:2 YCbCr`格式

下图表示`4：2：2`格式YCbCr采样点的定位。对于每两个水平Y采样点，有一个Cb和一个Cr采样点。每个采样颜色值的各颜色分量具有典型的8位(消费类应用)或10位(专业视频应用)。因此每个采样点需要16位(专业视频应用典则为20位),通常采用图3-4格式.

<image src="image/3-3.png"/>

<image src="image/3-4.png"/>

为了显示`4:2:2`的YCbCr数据，首先要转换为`4:4:4`的YCbCr数据，这需要采用`插值`来生成丢失的Cb和Cr采样信息。

### 3.3.3 `4:1:1`YCbCr格式

下图表示`4:1:1`格式YCbCr(也就是我们熟知的YUV12格式)采样点的定位。这种格式主要应用于消费类视频和DV（数字摄像机）视频压缩应用中。对于每4个水平Y采样点有一个Cb和一个Cr采样点。每个样点的颜色分量具有典型的8位数据，因此每个采样点需要12位，通常采用图3-6的格式。

<image src="image/3-5.png"/>

<image src="image/3-6.png"/>

为了显示`4:1:1`的YCbCr数据，首先要转换为`4:4:4`的YCbCr数据，这需要采用`插值`来生成丢失的Cb和Cr采样信息。

### 3.3.4 `4:2:0`YCbCr格式
与`4:2:2`YCbCr仅在水平方向对Cb和Cr减少为`2:1`不同，`4:2:0`YCbCr在水平和垂直方向上减少为2:1。这主要是应用于视频压缩领域。

<image src="image/3-6-1.png"/>
<image src="image/3-7.png"/>
<image src="image/3-8.png"/>
<image src="image/3-9.png"/>
<image src="image/3-10.png"/>

为了显示`4:2:0`的YCbCr数据，首先要转换为4:4:4的YCbCr数据，这需要采用插值来生成丢失的Cb和Cr采样信息。**注意**，有些解并不能正确地将`4:2:0`的YCbCr数据转换为`4:4:4`格式的YCbCr数据，因此会导致"色度陷阱".

## 3.4 xvYCC颜色空间
## 3.5 PhotoYCC颜色空间
## 3.6 HSI,HLS和HSV颜色空间转换
HSI(色调、饱和度、亮度)和HSV(色调、饱和度、纯度)颜色空间在处理颜色时更加"直观"，设计上使得颜色感知和解释的方式与人很接近。在需要手动指定颜色值时经常需要使用它们，但是，当用户可以以可视化的方式选择颜色或指定`潘通专业色卡`(Pantone color)时，就很少使用它们了。主要从传统习惯角度来讨论这些颜色空间。HLS（色调、亮度和饱和度）类似于HSI；只是使用了术语lightness，而不是intensity(光强度)来表示亮度。

HSI和HSV颜色空间之间的差异在于亮度分量(I或V)的计算方式，亮度分量同时确定了亮度(I或V)和饱和度(S)的分布和动态取值范围.HSI颜色空间最适合于传统的图像处理函数，如`卷积`,`均化`,`直方图`等。可以通过处理亮度值来实现这些操作，因为亮度I对R,G,B值的依赖度一眼的。
HSV颜色空间适合于颜色色度和饱和度(颜色偏移或调整颜色数量)，因为这是得饱和度具有更大的动态取值范围。

图3-12表示一个单六角锥HSV颜色模型。六角锥的上面对应于V=1，即具有最大亮度值的颜色。六角锥下面的顶点为黑色，V=0；互补色以H为测度，围绕垂直轴(V)的角度相差`180°`,即相互处于六角锥对等的位置上，红色对应的角度为`0°`.S的取值为一个比率(ratio)，去值范围从0到1,0对应于垂直轴(V)的中心线，1对应于六角锥的边。S在0到1之间的任何取值都与V=0的点相关。S=0，V=1的点为白色。S=0，V的中间值为灰色。**注意**，当S=0时，H的值是不相关的。从艺术家的观点看，任何V=1，S=1的颜色都是纯颜料(其颜色由H来定义)。增加白色等于减少S（V保持不变）；增加黑色等于减少V（S保持不变）。色调(tone)是通过同时减少S和V来生成的。表3.4列出了幅度为75%，饱和度为100%的HSV彩条。

<image src="image/3-12.png"/>
<image src="image/3-12-1.png"/>

图3-13表示的是双六角锥HSI颜色模型。六角锥的上面对应于I=1，即白色。六角锥下面的顶点为黑色，对应于I=0.互补色以H为测度，围绕垂直轴（I）的角度相差180°，即相互处于六角锥对等的位置上，红色对应的角度为0°（为了与HSV模型一致，我们已经改变了泰克公司在0°为0的约定）。S的取值范围从0到1，0对应于垂直轴(I),I对应于六角锥的面。灰度S恒等于0，但色度的最大饱和值在S=1，I=0.5处。表3-5列出了幅度值为75%、饱和度为100%的HSI彩条。

<image src="image/3-13.png"/>

<image src="image/3-13-1.png"/>
