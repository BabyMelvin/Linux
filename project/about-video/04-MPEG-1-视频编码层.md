### 4 视频编码层

MPEG-1允许在每秒60帧的逐行扫描方式下，分辨率最高可达到4095x4095.MPEG-1是约束参数比特流(CPB)的子集。CPB包括采样和比特率参数的有限集合，这些参数用来标准化缓存大小和存储带宽，是的编码器有名义上确保的互操作，同时解决最大可能的应用范围。

### 4.1 隔行视频
### 4.2 编码预处理

在进行MPEG编码之前，通过对视频流预处理，可以得到更好的图像。

在特定图像编码的时候，避免`严重失真`，可以对整幅图像(或者指定区域)采取`预滤波`。在压缩处理前的预滤波与`模/数转换前的抗混叠滤波`类似。预滤波考虑纹理样式、运动和边缘特点，可应用到图像、条带、宏块或者块等不同层次上。

### 4.3 编码帧类型
编码帧分为4类。

* I帧(约1比特/像素)是作为独立静态图像编码的帧。I帧提供在视频流中随机存取的随机存取点。通常，在1秒钟视频中出现2次I帧。此外，场景发生突变的地方也应该采用I帧。
* P帧(约0.1比特/像素)是与其相邻的前一I帧或P帧预测而得到的帧。通过运动补偿技术，`P帧`比`I帧`压缩更小，而且恩能够作为`B帧`和接下来的`P帧`作参考.
* B帧(约0.015比特/像素)采用最邻近的前后两个I帧或P帧作为参考帧，进行双向预测得到的帧。B帧有最高压缩率，并利用前后两帧的均值减少噪声。通常，I帧或P帧之间有2个B帧。
* D帧是仅包含DCT变换中的`直流系数`成分、按照独立静态图像编码的帧。D帧不能混在其他帧中，很少使用。

图像组(Group Of Picture,GOP)是用于辅助随机存取和编辑的一帧或多帧编码帧序列。在编码过程中GOP值是可以设置的，GOP值越小，对运动的响应效果越好(因为I帧靠得越近)，但是压缩率下降了。

<image src="image/12-1.png"/>
在编码比特流中，一个图像组必须以I帧作为开始，随后可以任意顺序接任意个I帧、P帧或B帧。在显示顺序中，图像组必须以I帧或B帧开始，以I帧或P帧结束。因此，最小的图像组是单个I帧，而最大图像组的大小是无限的。

最初，每个图像组不依赖其他图像组进行编码和显示。然而，这种情况只有没有B帧在I帧前才有可能。否则只能进行你像运动补偿。于是形成开放和封闭两种图像组格式。封闭图像组不需要之前的图像组做运动补偿就能完成解码，而开发图像组是需要的。

### 4.4 运动补偿
运动补偿用于消除帧间的时间冗余，提高对P帧和B帧的压缩效果。运动补偿主要在宏块层发挥作用。

**运动补偿技术原理基于以下事实**：在几幅大致相同图像的序列中，多数对象基本处在相同的位置，其余对象移动了一小段距离。这些欲动被描述成一个二维运动矢量，这个二维运动矢量用来指定从前一个解码帧的哪个位置获得一个宏块，改宏块用来预测当前宏块的像素值。

采用运动补偿压缩宏块之后，待编码宏块的参考宏块之间存在空间差异(运动矢量)和内容差异(误差项).

**注意**.有可能出现一个场景的信息不能从前一个场景预测出来的情况，例如打开一个门，先前的场景没有包含门后区域的细节信息的。在这些情况下，当P帧中的宏块不能表征运动补偿的时候，将采用与I帧中的宏块编码方式进行编码(采用帧间编码模式).

B帧中的宏块采用最邻近的前后I帧或P帧作为参照，于是有四种编码方式:

* 帧内编码，没有运动补偿
* 前向预测，最近的前一个I帧或P帧作为参考。
* 后向预测，最近的后一个I帧或P帧作为参考。
* 双向预测，两帧都用作为参考----最近的前一个I帧或P帧，以及后一个I帧或P帧。

后向预测用于预测前一帧没有覆盖的区域。

### 4.5 I帧

图像块和预测误差块有很高的空间冗余。为提高压缩率，去除冗余，采用了一下几个步骤，在解码的时候，采用相反的步骤可以恢复数据。

### 4.5.1 宏块
每一个宏块都是16像素x16行。
宏块由16像素x16行的Y分量和对象的8像素x8行Cb、Cr分量组成。块是8像素x8行的Y、Cb、Cr值的集合。注意Y块大小为图像(即相应Cb、Cr块)大小的四分之一。因此，一个宏块包含4个宏块、一个Cb块和一个Cr块。

<image src="image/12-2.png"/>
I帧内有两种宏块类型，两者都采用帧内编码的。一种(intra-d)采用当前的量化器刻度，另一种(intra-q)采用新的量化器刻度。

* 如果宏块类型为intra-q，宏块首部指定一个量化器刻度因子，长度为5.解码器用它从传送的量化系数中计算DCT系数。量化器刻度因子可以从1到31，但不允许为0。
* 如果宏块类型为intra-d，将不传送量化器刻度，解码器使用当前的刻度。

### 2.DCT
每个输入像素或预测误差项的8x8块采用的8x8的DCT(离散余弦变换)处理，得到8x8的水平和垂直方向的频率系数块。输入像素值范围是0~255，得到范围为0~2040的DC系数和-1000~+1000的AC系数。

### 3.量化
频率系数的8x8块是均匀量化的，取值有限。量化器补偿刻度由量化矩阵和量化器刻度决定，不同的系数对应不同的量化器补偿刻度，宏块与宏块间的量化器步长也有可能发生变化。

DC系数的量化器补偿大小固定为8。DC量化系数由DC系数除以8取得整数得到。AC系数由帧内量化矩阵量化得到。

### 4.Z形扫描
Z形扫描从DC分量开始，按照频率递增的顺序将量化频率系数排列线性流，这将产生游程的零系数。
